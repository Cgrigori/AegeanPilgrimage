from flask import Blueprint, render_template, abort
from ..models import Trip

bp = Blueprint("trips", __name__)

@bp.get("/")
def index():
	featured = Trip.query.filter_by(is_active=True).order_by(Trip.created_at.desc()).first()
	others = []
	if featured:
		others = Trip.query.filter(Trip.is_active==True, Trip.id != featured.id).order_by(Trip.created_at.desc()).all()
	else:
		others = Trip.query.filter_by(is_active=True).order_by(Trip.created_at.desc()).all()
	return render_template("trips/index.html", featured=featured, trips=others)

@bp.get("/<slug>")
def detail(slug):
	trip = Trip.query.filter_by(slug=slug, is_active=True).first()
	if not trip:
		abort(404)
	return render_template("trips/detail.html", trip=trip)
